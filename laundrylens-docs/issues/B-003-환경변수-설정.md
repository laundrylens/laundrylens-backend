# [B-003] 환경변수 설정

## 개요
- 이슈: ConfigModule을 사용한 환경변수 관리
- 작업 기간: 2026-01-28

## 구현 내용

### 주요 변경사항
- @nestjs/config 패키지 설치 및 설정
- class-validator를 통한 환경변수 유효성 검증
- 타입 안전한 설정 객체 제공
- .env.example 템플릿 업데이트

### 파일 구조
```
laundrylens-backend/
├── src/
│   ├── config/
│   │   ├── configuration.ts       # 설정 객체 정의
│   │   ├── configuration.spec.ts  # 설정 테스트
│   │   ├── env.validation.ts      # 환경변수 유효성 검증
│   │   └── index.ts               # 배럴 익스포트
│   └── app.module.ts              # ConfigModule 설정
└── .env.example                   # 환경변수 템플릿
```

## 기술적 세부사항

### 환경변수 카테고리
| 카테고리 | 변수 |
|---------|------|
| Application | NODE_ENV, PORT |
| Database | DATABASE_URL |
| JWT | JWT_SECRET, JWT_EXPIRES_IN, JWT_REFRESH_EXPIRES_IN |
| Kakao OAuth | KAKAO_CLIENT_ID, KAKAO_CLIENT_SECRET, KAKAO_CALLBACK_URL |
| Google OAuth | GOOGLE_CLIENT_ID, GOOGLE_CLIENT_SECRET, GOOGLE_CALLBACK_URL |
| OpenAI | OPENAI_API_KEY |
| Toss Payments | TOSS_CLIENT_KEY, TOSS_SECRET_KEY |
| Frontend | FRONTEND_URL |

### ConfigModule 설정
```typescript
ConfigModule.forRoot({
  isGlobal: true,        // 전역 모듈
  load: [configuration], // 설정 함수 로드
  validate,              // 유효성 검증 함수
  envFilePath: ['.env.local', '.env'],
})
```

### 사용 방법
```typescript
// ConfigService 주입
constructor(private configService: ConfigService) {}

// 값 조회
const port = this.configService.get<number>('port');
const dbUrl = this.configService.get<string>('database.url');
```

## 테스트

```bash
cd laundrylens-backend && pnpm test
```

### 테스트 케이스
- [x] 기본값 반환 확인 (PORT, FRONTEND_URL)
- [x] 커스텀 PORT 설정 확인
- [x] DATABASE_URL 설정 확인
- [x] JWT 설정 확인
- [x] OAuth 설정 확인

### 테스트 결과
```
PASS src/config/configuration.spec.ts
PASS src/app.controller.spec.ts
PASS src/prisma/prisma.service.spec.ts

Test Suites: 3 passed, 3 total
Tests:       11 passed, 11 total
```

## 의사결정 기록

| 날짜 | 결정 사항 | 이유 | 대안 |
|------|----------|------|------|
| 2026-01-28 | @nestjs/config 사용 | NestJS 공식 권장, 타입 안전 | dotenv 직접 사용 |
| 2026-01-28 | isGlobal: true | 모든 모듈에서 ConfigService 사용 가능 | 각 모듈에서 import |
| 2026-01-28 | @IsOptional() 사용 | 개발 환경 편의성, 필수값은 런타임에서 체크 | 모든 값 필수 |

## 참고 자료
- [NestJS Configuration](https://docs.nestjs.com/techniques/configuration)
- [class-validator](https://github.com/typestack/class-validator)
